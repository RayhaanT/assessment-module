function _typeof2(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof2=function(a){return typeof a}}else{_typeof2=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof2(a)}(function(a,b){"object"===("undefined"==typeof exports?"undefined":_typeof2(exports))&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define ("qtype_coderunner/diff",["exports"],b):(a=a||self,b(a.Diff={}))})(this,function(a){'use strict';function b(){}b.prototype={diff:function(a,b){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{},h=g.callback;if("function"==typeof g){h=g;g={}}this.options=g;var i=this;function e(a){if(h){setTimeout(function(){h(void 0,a)},0);return!0}else{return a}}a=this.castInput(a);b=this.castInput(b);a=this.removeEmpty(this.tokenize(a));b=this.removeEmpty(this.tokenize(b));var j=b.length,k=a.length,l=1,m=j+k,n=[{newPos:-1,components:[]}],o=this.extractCommon(n[0],b,a,0);if(n[0].newPos+1>=j&&o+1>=k){return e([{value:this.join(b),count:b.length}])}function f(){for(var f=-1*l;f<=l;f+=2){var g=void 0,h=n[f-1],m=n[f+1],o=(m?m.newPos:0)-f;if(h){n[f-1]=void 0}var p=h&&h.newPos+1<j,q=m&&0<=o&&o<k;if(!p&&!q){n[f]=void 0;continue}if(!p||q&&h.newPos<m.newPos){g=d(m);i.pushComponent(g.components,void 0,!0)}else{g=h;g.newPos++;i.pushComponent(g.components,!0,void 0)}o=i.extractCommon(g,b,a,f);if(g.newPos+1>=j&&o+1>=k){return e(c(i,g.components,b,a,i.useLongestToken))}else{n[f]=g}}l++}if(h){(function a(){setTimeout(function(){if(l>m){return h()}if(!f()){a()}},0)})()}else{while(l<=m){var p=f();if(p){return p}}}},pushComponent:function(a,b,c){var d=a[a.length-1];if(d&&d.added===b&&d.removed===c){a[a.length-1]={count:d.count+1,added:b,removed:c}}else{a.push({count:1,added:b,removed:c})}},extractCommon:function(a,b,c,d){var e=b.length,f=c.length,g=a.newPos,h=g-d,i=0;while(g+1<e&&h+1<f&&this.equals(b[g+1],c[h+1])){g++;h++;i++}if(i){a.components.push({count:i})}a.newPos=g;return h},equals:function(a,b){if(this.options.comparator){return this.options.comparator(a,b)}else{return a===b||this.options.ignoreCase&&a.toLowerCase()===b.toLowerCase()}},removeEmpty:function(a){for(var b=[],c=0;c<a.length;c++){if(a[c]){b.push(a[c])}}return b},castInput:function(a){return a},tokenize:function(a){return a.split("")},join:function(a){return a.join("")}};function c(a,b,c,d,e){var f=0,g=b.length,h=0,j=0;for(;f<g;f++){var k=b[f];if(!k.removed){if(!k.added&&e){var l=c.slice(h,h+k.count);l=l.map(function(a,b){var c=d[j+b];return c.length>a.length?c:a});k.value=a.join(l)}else{k.value=a.join(c.slice(h,h+k.count))}h+=k.count;if(!k.added){j+=k.count}}else{k.value=a.join(d.slice(j,j+k.count));j+=k.count;if(f&&b[f-1].added){var m=b[f-1];b[f-1]=b[f];b[f]=m}}}var n=b[g-1];if(1<g&&"string"==typeof n.value&&(n.added||n.removed)&&a.equals("",n.value)){b[g-2].value+=n.value;b.pop()}return b}function d(a){return{newPos:a.newPos,components:a.components.slice(0)}}var L=new b;function e(a,b){if("function"==typeof a){b.callback=a}else if(a){for(var c in a){if(a.hasOwnProperty(c)){b[c]=a[c]}}}return b}var M=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,N=/\S/,O=new b;O.equals=function(a,b){if(this.options.ignoreCase){a=a.toLowerCase();b=b.toLowerCase()}return a===b||this.options.ignoreWhitespace&&!N.test(a)&&!N.test(b)};O.tokenize=function(a){for(var b=a.split(/(\s+|[()[\]{}'"]|\b)/),c=0;c<b.length-1;c++){if(!b[c+1]&&b[c+2]&&M.test(b[c])&&M.test(b[c+2])){b[c]+=b[c+2];b.splice(c+1,2);c--}}return b};var P=new b;P.tokenize=function(a){var b=[],c=a.split(/(\n|\r\n)/);if(!c[c.length-1]){c.pop()}for(var d=0,e;d<c.length;d++){e=c[d];if(d%2&&!this.options.newlineIsToken){b[b.length-1]+=e}else{if(this.options.ignoreWhitespace){e=e.trim()}b.push(e)}}return b};function f(a,b,c){return P.diff(a,b,c)}var Q=new b;Q.tokenize=function(a){return a.split(/(\S.+?[.!?])(?=\s+|$)/)};var R=new b;R.tokenize=function(a){return a.split(/([{}:;,]|\s+)/)};function g(a){if("function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)){g=function(a){return _typeof2(a)}}else{g=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":_typeof2(a)}}return g(a)}function h(a){return i(a)||j(a)||k()}function i(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++){c[b]=a[b]}return c}}function j(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function k(){throw new TypeError("Invalid attempt to spread non-iterable instance")}var S=Object.prototype.toString,T=new b;T.useLongestToken=!0;T.tokenize=P.tokenize;T.castInput=function(a){var b=this.options,c=b.undefinedReplacement,d=b.stringifyReplacer,e=void 0===d?function(a,b){return"undefined"==typeof b?c:b}:d;return"string"==typeof a?a:JSON.stringify(l(a,null,null,e),e,"  ")};T.equals=function(a,c){return b.prototype.equals.call(T,a.replace(/,([\r\n])/g,"$1"),c.replace(/,([\r\n])/g,"$1"))};function l(a,b,c,d,e){b=b||[];c=c||[];if(d){a=d(e,a)}var f;for(f=0;f<b.length;f+=1){if(b[f]===a){return c[f]}}var h;if("[object Array]"===S.call(a)){b.push(a);h=Array(a.length);c.push(h);for(f=0;f<a.length;f+=1){h[f]=l(a[f],b,c,d,e)}b.pop();c.pop();return h}if(a&&a.toJSON){a=a.toJSON()}if("object"===g(a)&&null!==a){b.push(a);h={};c.push(h);var j=[],k;for(k in a){if(a.hasOwnProperty(k)){j.push(k)}}j.sort();for(f=0;f<j.length;f+=1){k=j[f];h[k]=l(a[k],b,c,d,k)}b.pop();c.pop()}else{h=a}return h}var U=new b;U.tokenize=function(a){return a.slice()};U.join=U.removeEmpty=function(a){return a};function m(a){var e=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},f=a.split(/\r\n|[\n\v\f\r\x85]/),g=a.match(/\r\n|[\n\v\f\r\x85]/g)||[],h=[],j=0;function b(){var a={};h.push(a);while(j<f.length){var b=f[j];if(/^(\-\-\-|\+\+\+|@@)\s/.test(b)){break}var g=/^(?:Index:|diff(?: -r \w+)+)\s+(.+?)\s*$/.exec(b);if(g){a.index=g[1]}j++}c(a);c(a);a.hunks=[];while(j<f.length){var i=f[j];if(/^(Index:|diff|\-\-\-|\+\+\+)\s/.test(i)){break}else if(/^@@/.test(i)){a.hunks.push(d())}else if(i&&e.strict){throw new Error("Unknown line "+(j+1)+" "+JSON.stringify(i))}else{j++}}}function c(a){var b=/^(---|\+\+\+)\s+(.*)$/.exec(f[j]);if(b){var c="---"===b[1]?"old":"new",d=b[2].split("\t",2),e=d[0].replace(/\\\\/g,"\\");if(/^".*"$/.test(e)){e=e.substr(1,e.length-2)}a[c+"FileName"]=e;a[c+"Header"]=(d[1]||"").trim();j++}}function d(){var a=j,b=f[j++],c=b.split(/@@ -(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))? @@/),d={oldStart:+c[1],oldLines:+c[2]||1,newStart:+c[3],newLines:+c[4]||1,lines:[],linedelimiters:[]},h=0,i=0;for(;j<f.length;j++){if(0===f[j].indexOf("--- ")&&j+2<f.length&&0===f[j+1].indexOf("+++ ")&&0===f[j+2].indexOf("@@")){break}var k=0==f[j].length&&j!=f.length-1?" ":f[j][0];if("+"===k||"-"===k||" "===k||"\\"===k){d.lines.push(f[j]);d.linedelimiters.push(g[j]||"\n");if("+"===k){h++}else if("-"===k){i++}else if(" "===k){h++;i++}}else{break}}if(!h&&1===d.newLines){d.newLines=0}if(!i&&1===d.oldLines){d.oldLines=0}if(e.strict){if(h!==d.newLines){throw new Error("Added line count did not match for hunk at line "+(a+1))}if(i!==d.oldLines){throw new Error("Removed line count did not match for hunk at line "+(a+1))}}return d}while(j<f.length){b()}return h}function n(a,b,c){var d=!0,e=!1,f=!1,g=1;return function h(){if(d&&!f){if(e){g++}else{d=!1}if(a+g<=c){return g}f=!0}if(!e){if(!f){d=!0}if(b<=a-g){return-g++}e=!0;return h()}}}function o(a,b){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};if("string"==typeof b){b=m(b)}if(Array.isArray(b)){if(1<b.length){throw new Error("applyPatch only works with a single input.")}b=b[0]}var e=a.split(/\r\n|[\n\v\f\r\x85]/),f=a.match(/\r\n|[\n\v\f\r\x85]/g)||[],g=b.hunks,h=d.compareLine||function(a,b,c,d){return b===d},k=0,l=d.fuzzFactor||0,o=0,p=0,q,r;function c(a,b){for(var c=0;c<a.lines.length;c++){var d=a.lines[c],f=0<d.length?d[0]:" ",g=0<d.length?d.substr(1):d;if(" "===f||"-"===f){if(!h(b+1,e[b],f,g)){k++;if(k>l){return!1}}b++}}return!0}for(var s=0;s<g.length;s++){var t=g[s],u=e.length-t.oldLines,v=0,w=p+t.oldStart-1,x=n(w,o,u);for(;v!==void 0;v=x()){if(c(t,w+v)){t.offset=p+=v;break}}if(v===void 0){return!1}o=t.offset+t.oldStart+t.oldLines}for(var y=0,z=0;z<g.length;z++){var A=g[z],B=A.oldStart+A.offset+y-1;y+=A.newLines-A.oldLines;if(0>B){B=0}for(var C=0;C<A.lines.length;C++){var D=A.lines[C],E=0<D.length?D[0]:" ",F=0<D.length?D.substr(1):D,G=A.linedelimiters[C];if(" "===E){B++}else if("-"===E){e.splice(B,1);f.splice(B,1)}else if("+"===E){e.splice(B,0,F);f.splice(B,0,G);B++}else if("\\"===E){var H=A.lines[C-1]?A.lines[C-1][0]:null;if("+"===H){q=!0}else if("-"===H){r=!0}}}}if(q){while(!e[e.length-1]){e.pop();f.pop()}}else if(r){e.push("");f.push("\n")}for(var I=0;I<e.length-1;I++){e[I]=e[I]+f[I]}return e.join("")}function p(a,b,c,d,e,g,j){if(!j){j={}}if("undefined"==typeof j.context){j.context=4}var l=f(c,d,j);l.push({value:"",lines:[]});function k(a){return a.map(function(a){return" "+a})}for(var m=[],n=0,o=0,p=[],q=1,r=1,s=function(a){var b=l[a],e=b.lines||b.value.replace(/\n$/,"").split("\n");b.lines=e;if(b.added||b.removed){var f;if(!n){var g=l[a-1];n=q;o=r;if(g){p=0<j.context?k(g.lines.slice(-j.context)):[];n-=p.length;o-=p.length}}(f=p).push.apply(f,h(e.map(function(a){return(b.added?"+":"-")+a})));if(b.added){r+=e.length}else{q+=e.length}}else{if(n){if(e.length<=2*j.context&&a<l.length-2){var i;(i=p).push.apply(i,h(k(e)))}else{var s,t=Math.min(e.length,j.context);(s=p).push.apply(s,h(k(e.slice(0,t))));var u={oldStart:n,oldLines:q-n+t,newStart:o,newLines:r-o+t,lines:p};if(a>=l.length-2&&e.length<=j.context){var v=/\n$/.test(c),w=/\n$/.test(d),x=0==e.length&&p.length>u.oldLines;if(!v&&x){p.splice(u.oldLines,0,"\\ No newline at end of file")}if(!v&&!x||!w){p.push("\\ No newline at end of file")}}m.push(u);n=0;o=0;p=[]}}q+=e.length;r+=e.length}},t=0;t<l.length;t++){s(t)}return{oldFileName:a,newFileName:b,oldHeader:e,newHeader:g,hunks:m}}function q(a,b,c,d,e,f,g){var h=p(a,b,c,d,e,f,g),j=[];if(a==b){j.push("Index: "+a)}j.push("===================================================================");j.push("--- "+h.oldFileName+("undefined"==typeof h.oldHeader?"":"\t"+h.oldHeader));j.push("+++ "+h.newFileName+("undefined"==typeof h.newHeader?"":"\t"+h.newHeader));for(var k=0,l;k<h.hunks.length;k++){l=h.hunks[k];j.push("@@ -"+l.oldStart+","+l.oldLines+" +"+l.newStart+","+l.newLines+" @@");j.push.apply(j,l.lines)}return j.join("\n")+"\n"}function r(c,a){if(c.length!==a.length){return!1}return s(c,a)}function s(a,b){if(b.length>a.length){return!1}for(var c=0;c<b.length;c++){if(b[c]!==a[c]){return!1}}return!0}function t(a){var b=J(a.lines),c=b.oldLines,d=b.newLines;if(c!==void 0){a.oldLines=c}else{delete a.oldLines}if(d!==void 0){a.newLines=d}else{delete a.newLines}}function u(a,b){if("string"==typeof a){if(/^@@/m.test(a)||/^Index:/m.test(a)){return m(a)[0]}if(!b){throw new Error("Must provide a base reference or pass in a patch")}return p(void 0,void 0,b,a)}return a}function v(a){return a.newFileName&&a.newFileName!==a.oldFileName}function w(a,b,c){if(b===c){return b}else{a.conflict=!0;return{mine:b,theirs:c}}}function x(a,b){return a.oldStart<b.oldStart&&a.oldStart+a.oldLines<b.oldStart}function y(a,b){return{oldStart:a.oldStart,oldLines:a.oldLines,newStart:a.newStart+b,newLines:a.newLines,lines:a.lines}}function z(a,b,c,d,e){var f={offset:b,lines:c,index:0},g={offset:d,lines:e,index:0};D(a,f,g);D(a,g,f);while(f.index<f.lines.length&&g.index<g.lines.length){var i=f.lines[f.index],j=g.lines[g.index];if(("-"===i[0]||"+"===i[0])&&("-"===j[0]||"+"===j[0])){A(a,f,g)}else if("+"===i[0]&&" "===j[0]){var k;(k=a.lines).push.apply(k,h(F(f)))}else if("+"===j[0]&&" "===i[0]){var l;(l=a.lines).push.apply(l,h(F(g)))}else if("-"===i[0]&&" "===j[0]){B(a,f,g)}else if("-"===j[0]&&" "===i[0]){B(a,g,f,!0)}else if(i===j){a.lines.push(i);f.index++;g.index++}else{C(a,F(f),F(g))}}E(a,f);E(a,g);t(a)}function A(a,b,c){var d=F(b),e=F(c);if(H(d)&&H(e)){if(s(d,e)&&I(c,d,d.length-e.length)){var f;(f=a.lines).push.apply(f,h(d));return}else if(s(e,d)&&I(b,e,e.length-d.length)){var g;(g=a.lines).push.apply(g,h(e));return}}else if(r(d,e)){var i;(i=a.lines).push.apply(i,h(d));return}C(a,d,e)}function B(a,b,c,d){var e=F(b),f=G(c,e);if(f.merged){var g;(g=a.lines).push.apply(g,h(f.merged))}else{C(a,d?f:e,d?e:f)}}function C(a,b,c){a.conflict=!0;a.lines.push({conflict:!0,mine:b,theirs:c})}function D(a,b,c){while(b.offset<c.offset&&b.index<b.lines.length){var d=b.lines[b.index++];a.lines.push(d);b.offset++}}function E(a,b){while(b.index<b.lines.length){var c=b.lines[b.index++];a.lines.push(c)}}function F(a){var b=[],c=a.lines[a.index][0];while(a.index<a.lines.length){var d=a.lines[a.index];if("-"===c&&"+"===d[0]){c="+"}if(c===d[0]){b.push(d);a.index++}else{break}}return b}function G(a,b){var c=[],d=[],e=0,f=!1,g=!1;while(e<b.length&&a.index<a.lines.length){var h=a.lines[a.index],i=b[e];if("+"===i[0]){break}f=f||" "!==h[0];d.push(i);e++;if("+"===h[0]){g=!0;while("+"===h[0]){c.push(h);h=a.lines[++a.index]}}if(i.substr(1)===h.substr(1)){c.push(h);a.index++}else{g=!0}}if("+"===(b[e]||"")[0]&&f){g=!0}if(g){return c}while(e<b.length){d.push(b[e++])}return{merged:d,changes:c}}function H(a){return a.reduce(function(a,b){return a&&"-"===b[0]},!0)}function I(a,b,c){for(var d=0,e;d<c;d++){e=b[b.length-c+d].substr(1);if(a.lines[a.index+d]!==" "+e){return!1}}a.index+=c;return!0}function J(a){var b=0,c=0;a.forEach(function(a){if("string"!=typeof a){var d=J(a.mine),e=J(a.theirs);if(b!==void 0){if(d.oldLines===e.oldLines){b+=d.oldLines}else{b=void 0}}if(c!==void 0){if(d.newLines===e.newLines){c+=d.newLines}else{c=void 0}}}else{if(c!==void 0&&("+"===a[0]||" "===a[0])){c++}if(b!==void 0&&("-"===a[0]||" "===a[0])){b++}}});return{oldLines:b,newLines:c}}function K(a){var b=a;b=b.replace(/&/g,"&amp;");b=b.replace(/</g,"&lt;");b=b.replace(/>/g,"&gt;");b=b.replace(/"/g,"&quot;");return b}a.Diff=b;a.diffChars=function(a,b,c){return L.diff(a,b,c)};a.diffWords=function(a,b,c){c=e(c,{ignoreWhitespace:!0});return O.diff(a,b,c)};a.diffWordsWithSpace=function(a,b,c){return O.diff(a,b,c)};a.diffLines=f;a.diffTrimmedLines=function(a,b,c){var d=e(c,{ignoreWhitespace:!0});return P.diff(a,b,d)};a.diffSentences=function(a,b,c){return Q.diff(a,b,c)};a.diffCss=function(a,b,c){return R.diff(a,b,c)};a.diffJson=function(a,b,c){return T.diff(a,b,c)};a.diffArrays=function(a,b,c){return U.diff(a,b,c)};a.structuredPatch=p;a.createTwoFilesPatch=q;a.createPatch=function(a,b,c,d,e,f){return q(a,a,b,c,d,e,f)};a.applyPatch=o;a.applyPatches=function(a,b){if("string"==typeof a){a=m(a)}var d=0;function c(){var e=a[d++];if(!e){return b.complete()}b.loadFile(e,function(a,d){if(a){return b.complete(a)}var f=o(d,e,b);b.patched(e,f,function(a){if(a){return b.complete(a)}c()})})}c()};a.parsePatch=m;a.merge=function(a,b,c){a=u(a,c);b=u(b,c);var d={};if(a.index||b.index){d.index=a.index||b.index}if(a.newFileName||b.newFileName){if(!v(a)){d.oldFileName=b.oldFileName||a.oldFileName;d.newFileName=b.newFileName||a.newFileName;d.oldHeader=b.oldHeader||a.oldHeader;d.newHeader=b.newHeader||a.newHeader}else if(!v(b)){d.oldFileName=a.oldFileName;d.newFileName=a.newFileName;d.oldHeader=a.oldHeader;d.newHeader=a.newHeader}else{d.oldFileName=w(d,a.oldFileName,b.oldFileName);d.newFileName=w(d,a.newFileName,b.newFileName);d.oldHeader=w(d,a.oldHeader,b.oldHeader);d.newHeader=w(d,a.newHeader,b.newHeader)}}d.hunks=[];var e=0,f=0,g=0,h=0;while(e<a.hunks.length||f<b.hunks.length){var i=a.hunks[e]||{oldStart:1/0},j=b.hunks[f]||{oldStart:1/0};if(x(i,j)){d.hunks.push(y(i,g));e++;h+=i.newLines-i.oldLines}else if(x(j,i)){d.hunks.push(y(j,h));f++;g+=j.newLines-j.oldLines}else{var k={oldStart:Math.min(i.oldStart,j.oldStart),oldLines:0,newStart:Math.min(i.newStart+g,j.oldStart+h),newLines:0,lines:[]};z(k,i.oldStart,i.lines,j.oldStart,j.lines);f++;e++;d.hunks.push(k)}}return d};a.convertChangesToDMP=function(a){for(var b=[],c,d,e=0;e<a.length;e++){c=a[e];if(c.added){d=1}else if(c.removed){d=-1}else{d=0}b.push([d,c.value])}return b};a.convertChangesToXML=function(a){for(var b=[],c=0,d;c<a.length;c++){d=a[c];if(d.added){b.push("<ins>")}else if(d.removed){b.push("<del>")}b.push(K(d.value));if(d.added){b.push("</ins>")}else if(d.removed){b.push("</del>")}}return b.join("")};a.canonicalize=l;Object.defineProperty(a,"__esModule",{value:!0})});
//# sourceMappingURL=diff.min.js.map
