function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("qtype_coderunner/lib-esm/line-by-line-renderer",["exports","./rematch","./render-utils","./types"],function(a,b,c,d){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.default=a.defaultLineByLineRendererConfig=void 0;b=f(b);c=f(c);function e(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;e=function(){return a};return a}function f(a){if(a&&a.__esModule){return a}if(null===a||"object"!==_typeof(a)&&"function"!=typeof a){return{default:a}}var b=e();if(b&&b.has(a)){return b.get(a)}var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in a){if(Object.prototype.hasOwnProperty.call(a,f)){var g=d?Object.getOwnPropertyDescriptor(a,f):null;if(g&&(g.get||g.set)){Object.defineProperty(c,f,g)}else{c[f]=a[f]}}}c.default=a;if(b){b.set(a,c)}return c}var g=void 0||function(){g=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b){if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}}return a};return g.apply(this,arguments)},h=g(g({},c.defaultRenderConfig),{renderNothingWhenEmpty:!1,matchingMaxComparisons:2500,maxLineSizeInBlockForComparison:200});a.defaultLineByLineRendererConfig=h;var i="generic",j="line-by-line",k=function(){function a(a,b){if(void 0===b){b={}}this.hoganUtils=a;this.config=g(g({},h),b)}a.prototype.render=function(a){var b=this,c=a.map(function(a){var c;if(a.blocks.length){c=b.generateFileHtml(a)}else{c=b.generateEmptyDiff()}return b.makeFileDiffHtml(a,c)}).join("\n");return this.hoganUtils.render(i,"wrapper",{content:c})};a.prototype.makeFileDiffHtml=function(a,b){if(this.config.renderNothingWhenEmpty&&Array.isArray(a.blocks)&&0===a.blocks.length)return"";var d=this.hoganUtils.template(j,"file-diff"),e=this.hoganUtils.template(i,"file-path"),f=this.hoganUtils.template("icon","file"),g=this.hoganUtils.template("tag",c.getFileIcon(a));return d.render({file:a,fileHtmlId:c.getHtmlId(a),diffs:b,filePath:e.render({fileDiffName:c.filenameDiff(a)},{fileIcon:f,fileTag:g})})};a.prototype.generateEmptyDiff=function(){return this.hoganUtils.render(i,"empty-diff",{contentClass:"d2h-code-line",CSSLineClass:c.CSSLineClass})};a.prototype.generateFileHtml=function(a){var d=this,e=b.newMatcherFn(b.newDistanceFn(function(b){return c.deconstructLine(b.content,a.isCombined).content}));return a.blocks.map(function(b){var f=d.hoganUtils.render(i,"block-header",{CSSLineClass:c.CSSLineClass,blockHeader:c.escapeForHtml(b.header),lineClass:"d2h-code-linenumber",contentClass:"d2h-code-line"});d.applyLineGroupping(b).forEach(function(b){var g=b[0],h=b[1],i=b[2];if(h.length&&i.length&&!g.length){d.applyRematchMatching(h,i,e).map(function(b){var c=b[0],e=b[1],g=d.processChangedLines(a.isCombined,c,e),h=g.left,i=g.right;f+=h;f+=i})}else if(g.length){g.forEach(function(b){var e=c.deconstructLine(b.content,a.isCombined),g=e.prefix,h=e.content;f+=d.generateSingleLineHtml({type:c.CSSLineClass.CONTEXT,prefix:g,content:h,oldNumber:b.oldNumber,newNumber:b.newNumber})})}else if(h.length||i.length){var j=d.processChangedLines(a.isCombined,h,i),k=j.left,l=j.right;f+=k;f+=l}else{console.error("Unknown state reached while processing groups of lines",g,h,i)}});return f}).join("\n")};a.prototype.applyLineGroupping=function(a){for(var b=[],c=[],e=[],f=0,g;f<a.lines.length;f++){g=a.lines[f];if(g.type!==d.LineType.INSERT&&e.length||g.type===d.LineType.CONTEXT&&0<c.length){b.push([[],c,e]);c=[];e=[]}if(g.type===d.LineType.CONTEXT){b.push([[g],[],[]])}else if(g.type===d.LineType.INSERT&&0===c.length){b.push([[],[],[g]])}else if(g.type===d.LineType.INSERT&&0<c.length){e.push(g)}else if(g.type===d.LineType.DELETE){c.push(g)}}if(c.length||e.length){b.push([[],c,e]);c=[];e=[]}return b};a.prototype.applyRematchMatching=function(a,b,c){var d=a.length*b.length,e=Math.max.apply(null,[0].concat(a.concat(b).map(function(a){return a.content.length}))),f=d<this.config.matchingMaxComparisons&&e<this.config.maxLineSizeInBlockForComparison&&("lines"===this.config.matching||"words"===this.config.matching);return f?c(a,b):[[a,b]]};a.prototype.processChangedLines=function(a,b,d){for(var e={right:"",left:""},f=Math.max(b.length,d.length),h=0;h<f;h++){var j=b[h],k=d[h],l=j!==void 0&&k!==void 0?c.diffHighlight(j.content,k.content,a,this.config):void 0,m=j!==void 0&&j.oldNumber!==void 0?g(g({},l!==void 0?{prefix:l.oldLine.prefix,content:l.oldLine.content,type:c.CSSLineClass.DELETE_CHANGES}:g(g({},c.deconstructLine(j.content,a)),{type:c.toCSSClass(j.type)})),{oldNumber:j.oldNumber,newNumber:j.newNumber}):void 0,n=k!==void 0&&k.newNumber!==void 0?g(g({},l!==void 0?{prefix:l.newLine.prefix,content:l.newLine.content,type:c.CSSLineClass.INSERT_CHANGES}:g(g({},c.deconstructLine(k.content,a)),{type:c.toCSSClass(k.type)})),{oldNumber:k.oldNumber,newNumber:k.newNumber}):void 0,o=this.generateLineHtml(m,n),p=o.left,q=o.right;e.left+=p;e.right+=q}return e};a.prototype.generateLineHtml=function(a,b){return{left:this.generateSingleLineHtml(a),right:this.generateSingleLineHtml(b)}};a.prototype.generateSingleLineHtml=function(a){if(a===void 0)return"";var b=this.hoganUtils.render(j,"numbers",{oldNumber:a.oldNumber||"",newNumber:a.newNumber||""});return this.hoganUtils.render(i,"line",{type:a.type,lineClass:"d2h-code-linenumber",contentClass:"d2h-code-line",prefix:" "===a.prefix?"&nbsp;":a.prefix,content:a.content,lineNumber:b})};return a}();a.default=k;return a.default});
//# sourceMappingURL=line-by-line-renderer.min.js.map
