{"version":3,"sources":["../../../../src/lib-esm/ui/js/diff2html-ui-base.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","defaultDiff2HtmlUIConfig","defaultDiff2HtmlConfig","synchronisedScroll","highlight","fileListToggle","fileListStartVisible","smartSelection","Diff2HtmlUI","target","diffInput","config","hljs","currentSelectionColumnId","diffHtml","innerHTML","targetElement","draw","highlightCode","querySelectorAll","forEach","wrapper","_a","slice","left","right","onScroll","event","scrollTop","scrollLeft","addEventListener","startVisible","showBtn","querySelector","hideBtn","fileList","show","style","display","hide","hashTag","getHashTag","_this","Error","files","file","oldLinesState","newLinesState","codeLines","line","text","textContent","lineParent","parentNode","isElement","lineState","classList","contains","language","getAttribute","result","getLanguage","highlightAuto","instanceOfIHighlightResult","top","originalStream","resultNode","document","createElementNS","value","add","console","warn","object","docUrl","URL","hashTagIndex","indexOf","substr","arg"],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { nodeStream, mergeStreams } from './highlight-helpers';\nimport { html, defaultDiff2HtmlConfig } from '../../diff2html';\nexport var defaultDiff2HtmlUIConfig = __assign(__assign({}, defaultDiff2HtmlConfig), { synchronisedScroll: true, highlight: true, fileListToggle: true, fileListStartVisible: false, smartSelection: true });\nvar Diff2HtmlUI = (function () {\n    function Diff2HtmlUI(target, diffInput, config, hljs) {\n        if (config === void 0) { config = {}; }\n        this.hljs = null;\n        this.currentSelectionColumnId = -1;\n        this.config = __assign(__assign({}, defaultDiff2HtmlUIConfig), config);\n        this.diffHtml = diffInput !== undefined ? html(diffInput, this.config) : target.innerHTML;\n        this.targetElement = target;\n        if (hljs !== undefined)\n            this.hljs = hljs;\n    }\n    Diff2HtmlUI.prototype.draw = function () {\n        this.targetElement.innerHTML = this.diffHtml;\n        if (this.config.synchronisedScroll)\n            this.synchronisedScroll();\n        if (this.config.highlight)\n            this.highlightCode();\n        if (this.config.fileListToggle)\n            this.fileListToggle(this.config.fileListStartVisible);\n    };\n    Diff2HtmlUI.prototype.synchronisedScroll = function () {\n        this.targetElement.querySelectorAll('.d2h-file-wrapper').forEach(function (wrapper) {\n            var _a = Array().slice.call(wrapper.querySelectorAll('.d2h-file-side-diff')), left = _a[0], right = _a[1];\n            if (left === undefined || right === undefined)\n                return;\n            var onScroll = function (event) {\n                if (event === null || event.target === null)\n                    return;\n                if (event.target === left) {\n                    right.scrollTop = left.scrollTop;\n                    right.scrollLeft = left.scrollLeft;\n                }\n                else {\n                    left.scrollTop = right.scrollTop;\n                    left.scrollLeft = right.scrollLeft;\n                }\n            };\n            left.addEventListener('scroll', onScroll);\n            right.addEventListener('scroll', onScroll);\n        });\n    };\n    Diff2HtmlUI.prototype.fileListToggle = function (startVisible) {\n        var showBtn = this.targetElement.querySelector('.d2h-show');\n        var hideBtn = this.targetElement.querySelector('.d2h-hide');\n        var fileList = this.targetElement.querySelector('.d2h-file-list');\n        if (showBtn === null || hideBtn === null || fileList === null)\n            return;\n        var show = function () {\n            showBtn.style.display = 'none';\n            hideBtn.style.display = 'inline';\n            fileList.style.display = 'block';\n        };\n        var hide = function () {\n            showBtn.style.display = 'inline';\n            hideBtn.style.display = 'none';\n            fileList.style.display = 'none';\n        };\n        showBtn.addEventListener('click', function () { return show(); });\n        hideBtn.addEventListener('click', function () { return hide(); });\n        var hashTag = this.getHashTag();\n        if (hashTag === 'files-summary-show')\n            show();\n        else if (hashTag === 'files-summary-hide')\n            hide();\n        else if (startVisible)\n            show();\n        else\n            hide();\n    };\n    Diff2HtmlUI.prototype.highlightCode = function () {\n        var _this = this;\n        if (this.hljs === null) {\n            throw new Error('Missing a `highlight.js` implementation. Please provide one when instantiating Diff2HtmlUI.');\n        }\n        var files = this.targetElement.querySelectorAll('.d2h-file-wrapper');\n        files.forEach(function (file) {\n            var oldLinesState;\n            var newLinesState;\n            var codeLines = file.querySelectorAll('.d2h-code-line-ctn');\n            codeLines.forEach(function (line) {\n                if (_this.hljs === null)\n                    return;\n                var text = line.textContent;\n                var lineParent = line.parentNode;\n                if (text === null || lineParent === null || !_this.isElement(lineParent))\n                    return;\n                var lineState = lineParent.classList.contains('d2h-del') ? oldLinesState : newLinesState;\n                var language = file.getAttribute('data-lang');\n                var result = language && _this.hljs.getLanguage(language)\n                    ? _this.hljs.highlight(language, text, true, lineState)\n                    : _this.hljs.highlightAuto(text);\n                if (_this.instanceOfIHighlightResult(result)) {\n                    if (lineParent.classList.contains('d2h-del')) {\n                        oldLinesState = result.top;\n                    }\n                    else if (lineParent.classList.contains('d2h-ins')) {\n                        newLinesState = result.top;\n                    }\n                    else {\n                        oldLinesState = result.top;\n                        newLinesState = result.top;\n                    }\n                }\n                var originalStream = nodeStream(line);\n                if (originalStream.length) {\n                    var resultNode = document.createElementNS('http://www.w3.org/1999/xhtml', 'div');\n                    resultNode.innerHTML = result.value;\n                    result.value = mergeStreams(originalStream, nodeStream(resultNode), text);\n                }\n                line.classList.add('hljs');\n                line.classList.add(result.language);\n                line.innerHTML = result.value;\n            });\n        });\n    };\n    Diff2HtmlUI.prototype.smartSelection = function () {\n        console.warn('Smart selection is now enabled by default with CSS. No need to call this method anymore.');\n    };\n    Diff2HtmlUI.prototype.instanceOfIHighlightResult = function (object) {\n        return 'top' in object;\n    };\n    Diff2HtmlUI.prototype.getHashTag = function () {\n        var docUrl = document.URL;\n        var hashTagIndex = docUrl.indexOf('#');\n        var hashTag = null;\n        if (hashTagIndex !== -1) {\n            hashTag = docUrl.substr(hashTagIndex + 1);\n        }\n        return hashTag;\n    };\n    Diff2HtmlUI.prototype.isElement = function (arg) {\n        var _a;\n        return arg !== null && ((_a = arg) === null || _a === void 0 ? void 0 : _a.classList) !== undefined;\n    };\n    return Diff2HtmlUI;\n}());\nexport { Diff2HtmlUI };\n//# sourceMappingURL=diff2html-ui-base.js.map"],"file":"diff2html-ui-base.min.js"}