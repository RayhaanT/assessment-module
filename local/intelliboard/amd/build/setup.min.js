define(["jquery","local_intelliboard/setup_moodle_settings","local_intelliboard/setup_terms","local_intelliboard/setup_authentication"],function(e,o,n,a){var i={activeRequest:!1,serviceToken:"",useRestProtocol:!0,init:function(){i.moodleSettingsHandler(),i.termsHandler()},moodleSettingsHandler:function(){e(".moodle-settings .tab-header-button button.next, .moodle-settings .tab-body-button button.next").unbind("click"),e(".moodle-settings .tab-header-button button.next, .moodle-settings .tab-body-button button.next").on("click",function(){i.activeRequest||(i.activeRequest=!0,o.hideErrors(),o.loaderContainer.removeClass("hidden"),o.save(function(t){i.activeRequest=!1,o.loaderContainer.addClass("hidden"),"success"===t.status?(i.serviceToken=JSON.parse(t.data).token,i.useRestProtocol=e("#rest_protocol").is(":checked"),o.closeTab(),n.openTab()):o.showErrors(t.data)}))}),e(".moodle-settings .choose-group .item").unbind("click"),e(".moodle-settings .choose-group .item").on("click",function(){e(".moodle-settings .choose-group .item").removeClass("active"),e(".moodle-settings .choose-group .item input").prop("checked",!1).attr("checked",""),e(this).addClass("active"),e(this).find("input").attr("checked","checked").prop("checked",!0)})},termsHandler:function(){e(".tab-item.terms .tab-header-button button.next, .tab-item.terms .tab-body-button button.next").unbind("click"),e(".tab-item.terms .tab-header-button button.next, .tab-item.terms .tab-body-button button.next").on("click",function(){i.activeRequest||(n.hideErrors(),n.loaderContainer.removeClass("hidden"),n.termsIsAccepted()?(n.loaderContainer.addClass("hidden"),n.closeTab(),i.authenticationHandler()):n.showErrorMessage(function(){n.loaderContainer.addClass("hidden")}))}),e(".tab-item.terms .tab-header-button button.back, .tab-item.terms .tab-body-button button.back").on("click",function(){n.closeTab(),o.openTab()})},authenticationHandler:function(){var t=e("#subscription_email").val();a.openTab(),a.setFormEmail(t),a.loaderContainer.removeClass("hidden"),a.checkEmail(t,function(t){t.email_exists?(a.showLoginForm(),a.loginHandler(i.serviceToken,i.useRestProtocol,function(){a.closeTab(),e(".setup-wrapper .tab-item.congrats").removeClass("closed")})):(a.showRegisterForm(),a.registerHandler(i.serviceToken,i.useRestProtocol,function(){a.closeTab(),e(".setup-wrapper .tab-item.congrats").removeClass("closed")}))}),e(".tab-item.authentication .tab-header-button button.back, .tab-item.authentication .tab-body-button button.back").on("click",function(){a.closeTab(),a.hideLoginForm(),a.hideRegisterForm(),n.openTab()})}};return i});